version: 2

unit_tests:
  - name: test_negative_amount_conversion
    model: stg_orders
    description: |
      Tests if negative values in total_amount are converted to zero in staging layer.
      
      Business rule: Orders cannot have negative amounts, so they should be converted to 0.
      
      Test cases:
      - Negative amount (-50.0) should become 0.0
      - Positive amount (100.0) should remain unchanged
      - Zero amount (0.0) should remain zero
    
    given:
      - input: ref('raw_orders')
        rows:
          - {id: 1, customer_id: 100, order_date: "2024-01-01", status: "delivered", total_amount: -50.0, payment_method: "credit_card", delivery_address: "Test Address A", created_at: "2024-01-01"}
          - {id: 2, customer_id: 101, order_date: "2024-01-02", status: "shipped", total_amount: 100.0, payment_method: "pix", delivery_address: "Test Address B", created_at: "2024-01-02"}
          - {id: 3, customer_id: 102, order_date: "2024-01-03", status: "processing", total_amount: 0.0, payment_method: "boleto", delivery_address: "Test Address C", created_at: "2024-01-03"}
    
    expect:
      rows:
        - {order_id: 1, customer_id: 100, total_amount: 0.0, is_high_value_order: false}
        - {order_id: 2, customer_id: 101, total_amount: 100.0, is_high_value_order: false}
        - {order_id: 3, customer_id: 102, total_amount: 0.0, is_high_value_order: false}
